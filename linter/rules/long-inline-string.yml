id: long-inline-string
language: nix
severity: warning
# Excluded:
# - prelude: IS the library, legitimately wraps nixpkgs
# - checks: test infrastructure, will be replaced by buck2
ignores:
  - nix/prelude/**/*.nix
  - nix/checks/**/*.nix
rule:
  kind: indented_string_expression
  regex: "(?s)(?:.*\\n){12,}"
message: "WSN-W003: long inline string"
note: |
  ## What's wrong?
  A multi-line string exceeds 10 lines (nice try,
  that inline script isn't getting past me).

  Anything longer than 10 lines is likely to be a script
  in some other language. This is one of the most common sources
  of bugs in nix code, so we disallow it.

  ## What can I do to fix this?
  Consider moving the content to a file and loading it with `builtins.readFile`.

  If you need no interpolation:
  ```nix
  builtins.readFile ./my-file.sh
  ```

  If you variable interpolation:
  ```nix
  pkgs.replaceVars ./my-file.sh { x = "foo"; }
  ```
