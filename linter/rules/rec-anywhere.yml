id: rec-anywhere
language: nix
severity: error
# Exclude prelude (functional programming patterns legitimately use rec)
# Exclude lib (utility functions may use rec for self-reference)
ignores:
  - nix/prelude/**/*.nix
  - nix/lib/**/*.nix
rule:
  kind: rec_attrset_expression
message: "WSN-W001: recursive attrset"
note: |
  ## What's wrong?
  A recursive attrset (`rec { ... }`) was found.

  This is flagged for review because it:
  - Can hide evaluation order issues
  - Makes dependency flow harder to reason about

  ## What can I do to fix this?
  Prefer non-recursive attrsets or a fixed-point function when needed.

  ```nix
  let
    shared = pkgs.callPackage ./pkg.nix { };
  in
  {
    inherit shared;
    default = shared;
  }
  ```
