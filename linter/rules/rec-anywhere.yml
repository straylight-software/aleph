id: rec-anywhere
language: nix
severity: error
# Legitimate uses of rec for self-referencing function sets:
#   - prelude: FP function sets (map, fold, etc. call sibling helpers)
#   - lib: namespaced utilities (oci.ref-to-name calls oci.parse-ref, etc.)
ignores:
  - nix/prelude/**/*.nix
  - nix/lib/**/*.nix
rule:
  kind: rec_attrset_expression
message: "ALEPH-W001: recursive attrset"
note: |
  ## What's wrong?
  A recursive attrset (`rec { ... }`) was found.

  This is flagged for review because it:
  - Can hide evaluation order issues
  - Makes dependency flow harder to reason about

  ## What can I do to fix this?
  Prefer non-recursive attrsets or a fixed-point function when needed.

  ```nix
  let
    shared = pkgs.callPackage ./pkg.nix { };
  in
  {
    inherit shared;
    default = shared;
  }
  ```
