// Google ByteStream API - for large blob upload/download
// Source: https://github.com/googleapis/googleapis
//
// Used by Remote Execution API for blobs > 4MB

syntax = "proto3";

package google.bytestream;

option java_package = "com.google.bytestream";
option java_outer_classname = "ByteStreamProto";

import "google/protobuf/wrappers.proto";

// Request object for ByteStream.Read.
message ReadRequest {
  // The name of the resource to read.
  // For CAS: {instance_name}/blobs/{hash}/{size}
  string resource_name = 1;

  // The offset for the first byte to return in the read, relative to the start
  // of the resource.
  int64 read_offset = 2;

  // The maximum number of `data` bytes the server is allowed to return.
  // A `read_limit` of zero indicates that there is no limit.
  int64 read_limit = 3;
}

// Response object for ByteStream.Read.
message ReadResponse {
  // A portion of the data for the resource.
  bytes data = 10;
}

// Request object for ByteStream.Write.
message WriteRequest {
  // The name of the resource to write.
  // For CAS: {instance_name}/uploads/{uuid}/blobs/{hash}/{size}
  string resource_name = 1;

  // The offset from the beginning of the resource at which the data should be
  // written. In the first `WriteRequest`, this must be zero.
  int64 write_offset = 2;

  // If `true`, this indicates that the write is complete. Sending any
  // `WriteRequest`s subsequent to one in which `finish_write` is `true` will
  // cause an error.
  bool finish_write = 3;

  // A portion of the data for the resource.
  bytes data = 10;
}

// Response object for ByteStream.Write.
message WriteResponse {
  // The number of bytes that have been processed for the given resource.
  int64 committed_size = 1;
}

// Request object for ByteStream.QueryWriteStatus.
message QueryWriteStatusRequest {
  // The name of the resource whose write status is being requested.
  string resource_name = 1;
}

// Response object for ByteStream.QueryWriteStatus.
message QueryWriteStatusResponse {
  // The number of bytes that have been processed for the given resource.
  int64 committed_size = 1;

  // `complete` is `true` only if the client has sent a `WriteRequest` with
  // `finish_write` set to true, and the server has processed that request.
  bool complete = 2;
}

// ByteStream API for reading and writing content-addressed data.
service ByteStream {
  // Read data from a resource.
  rpc Read(ReadRequest) returns (stream ReadResponse);

  // Write data to a resource.
  rpc Write(stream WriteRequest) returns (WriteResponse);

  // Query the status of a write operation.
  rpc QueryWriteStatus(QueryWriteStatusRequest)
      returns (QueryWriteStatusResponse);
}
