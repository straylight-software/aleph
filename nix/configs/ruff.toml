# aleph ruff.toml - The Law
line-length = 100
indent-width = 2
target-version = "py313"
output-format = "pylint"

[format]
quote-style = "double"
indent-style = "space"
skip-magic-trailing-comma = false
line-ending = "auto"
docstring-code-format = true
docstring-code-line-length = 80

exclude = [
  ".git",
  ".ruff_cache",
  ".venv",
  "venv",
  "__pycache__",
  "*.egg-info",
  ".pytest_cache",
  ".mypy_cache",
  "build",
  "dist",
  "result",
  "notebooks/.ipynb_checkpoints",
]

[lint]
select = [
  "E",    # pycodestyle errors
  "W",    # pycodestyle warnings
  "F",    # pyflakes
  "I",    # isort
  "N",    # pep8-naming
  "D",    # pydocstyle
  "UP",   # pyupgrade
  "B",    # flake8-bugbear
  "C4",   # flake8-comprehensions
  "SIM",  # flake8-simplify
  "TCH",  # flake8-type-checking
  "RUF",  # Ruff-specific rules
  "PTH",  # flake8-use-pathlib
  "FBT",  # flake8-boolean-trap
  "PL",   # Pylint
  "PERF", # Perflint
  "FURB", # refurb
  "LOG",  # flake8-logging
  "G",    # flake8-logging-format
  "PIE",  # flake8-pie
  "COM",  # flake8-commas
  "C90",  # mccabe complexity
  "ERA",  # eradicate
  "ARG",  # flake8-unused-arguments
  "PD",   # pandas-vet
  "NPY",  # NumPy-specific rules
]

ignore = [
  # PyTorch specific
  "N803", # Argument name should be lowercase (common in PyTorch: N, C, H, W)
  "N806", # Variable in function should be lowercase (A, B, C matrices)
  "N812", # Lowercase imported as non-lowercase (import torch.nn.functional as F)

  # Documentation (relax for research/experimental code)
  "D100", # Missing docstring in public module
  "D101", # Missing docstring in public class
  "D102", # Missing docstring in public method
  "D103", # Missing docstring in public function
  "D104", # Missing docstring in public package
  "D105", # Missing docstring in magic method
  "D107", # Missing docstring in __init__
  "D203", # 1 blank line required before class docstring
  "D212", # Multi-line docstring summary should start at the first line
  "D213", # Multi-line docstring summary should start at the second line
  "D402", # First line should not be the function's signature

  # Too strict for ML code
  "PLR0912", # Too many branches
  "PLR0913", # Too many arguments to function call
  "PLR0915", # Too many statements
  "PLR2004", # Magic value used in comparison
  "C901",    # Function is too complex

  # Common in PyTorch code
  "FBT001", # Boolean positional arg in function definition
  "FBT002", # Boolean default value in function definition
  "SIM108", # Use ternary operator (sometimes less readable)
  "COM812", # Missing trailing comma (conflicts with formatter)

  # Allow some flexibility
  "ERA001", # Found commented-out code
  "G004",   # Logging statement uses f-string
  "RUF003", # Matrix Multiplication via `[axb]` in comments
  "E501",   # Prompts are often long
]

[lint.per-file-ignores]
"**/tests/**" = [
  "D",       # Don't require docstrings in tests
  "PLR2004", # Magic values are OK in tests
  "ARG",     # Unused arguments are OK in tests
]
"**/__init__.py" = ["D104"]
"**/notebooks/**" = [
  "E402", # Module level import not at top of file
  "F401", # Imported but unused (common in notebooks)
  "E501", # Line too long (output cells)
]

[lint.pydocstyle]
convention = "google"

[lint.isort]
known-first-party = ["src"]
known-third-party = ["matplotlib", "numpy", "pandas", "torch", "torchvision"]
lines-after-imports = 2
section-order = [
  "future",
  "standard-library",
  "third-party",
  "first-party",
  "local-folder",
]

[lint.mccabe]
max-complexity = 15

[lint.pylint]
max-args = 8
max-branches = 15
max-returns = 6
max-statements = 50

[lint.flake8-quotes]
inline-quotes = "double"
multiline-quotes = "double"
docstring-quotes = "double"

[lint.flake8-type-checking]
runtime-evaluated-base-classes = ["torch.nn.Module", "pydantic.BaseModel"]

[lint.flake8-unused-arguments]
ignore-variadic-names = true
